version: "3.6"

services:
  mqtt-server:
    image: ghcr.io/us-joet/everest-demo/mqtt-server:build_pkg_add-15118-dash-2-logs-to-dc-demo
    logging:
      driver: none
    ports:
      - 1883:1883

  manager:
    image: ghcr.io/us-joet/everest-demo/manager:build_pkg_add-15118-dash-2-logs-to-dc-demo
    depends_on:
      - mqtt-server
    environment:
      - MQTT_SERVER_ADDRESS=mqtt-server
    entrypoint: "sh ./build/run-scripts/run-sil-dc.sh"
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=0

  node-red:
    image: ghcr.io/us-joet/everest-demo/nodered:build_pkg_add-15118-dash-2-logs-to-dc-demo
    depends_on:
      - mqtt-server
    environment:
      - MQTT_SERVER_ADDRESS=mqtt-server
      - FLOWS=/config/config-sil-dc-flow.json
    ports:
      - 1880:1880
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=0
